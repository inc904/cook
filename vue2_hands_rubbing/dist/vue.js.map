{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/init.js","../src/index.js"],"sourcesContent":["// 我们希望重写数组中的部分方法\nlet oldArrayProto = Array.prototype\n\n// Array.prototype.push = function (){}  // 会被直接覆盖，Bad\n\n// 拷贝 一份新的出来\n\n// newArrayProto.__proto__ = oldArrayProto\nexport let newArrayProto = Object.create(oldArrayProto)\n\n// newArrayProto.push = function(){}\n\n// 找到所有的变异方法\nlet methods = ['push', 'pop', 'shift', 'unshift', 'reverse', 'sort', 'splice']\n\nmethods.forEach(method => {\n  // 重写数组的方法\n  newArrayProto[method] = function (...args) {\n    // 内部调用原来的方法， 函数的劫持， 切片编程\n    const result = oldArrayProto[method].call(this, ...args)\n\n    // 我们需要对新增的 数据 再次进行劫持\n    let inserted\n    let ob = this.__ob__\n    switch (method) {\n      case 'push':\n      case 'unshift':\n        inserted = args\n        break\n      case 'splice':\n        inserted = args.slice(2)\n      default:\n        break\n    }\n    console.log({inserted})\n    if(inserted){\n      // 对新增内容 再次进行观测\n      /*\n      需要用到 对数组的观测方法，考虑 从 this (data) 上引入\n      定义 自定义属性 data.__ob__，使得我们可以使用 Observe 上\n      的 数组观测方法\n     */\n      ob.observeArray(inserted)\n    }\n\n    return result\n  }\n})\n","import { newArrayProto } from './array'\n\nclass Observe {\n  constructor(data) {\n    // Object.defineProperty  只能劫持 已经存在的属性，增加的 删除的 都不会被劫持 （增加$set. $delete）\n    // data.__ob__ = this // 给数据加一个标识，如果数据上有 __ob__ 则说明这个属性被观测到了\n    Object.defineProperty(data, '__ob__', {\n      value: this,\n      enumerable: false // 将 __ob__ 变成不可枚举（循环的时候无法获取到）\n    })\n\n    if (Array.isArray(data)) {\n      // 重写 7个数组 变异方法（会修改数组本身的方法）\n\n      data.__proto__ = newArrayProto\n\n      this.observeArray(data)\n    } else {\n      this.walk(data)\n    }\n\n    // this.walk(data)\n  }\n  walk(data) {\n    // 循环对象 对属性 依次劫持\n    Object.keys(data).forEach(key => {\n      // Object.defineProperty(data, data[key],{})\n      // ”重新定义“ 属性\n      defineReactive(data, key, data[key])\n    })\n  }\n  observeArray(data) {\n    data.forEach(item => observe(item))\n  }\n}\n\nexport function defineReactive(target, key, value) {\n  // Object.defineProperty(data, data[key],{})\n\n  if (arguments.length == 2) value = target[key]\n\n  observe(value)\n\n  Object.defineProperty(target, key, {\n    get() {\n      console.log('用户取值了')\n      return value\n    },\n    set(newValue) {\n      console.log('用户设置值了')\n      if (newValue === value) return\n      observe(newValue)\n      value = newValue\n    }\n  })\n}\n\nexport function observe(data) {\n  // 对data对象进行劫持\n  if (typeof data !== 'object' || data == null) return\n\n  // 如果 一个对象 被劫持过了，那就不需要再 劫持了，\n  // 判断对象是否被劫持， 增加了一个实例 来判断\n  if (data.__ob__ instanceof Observe) {\n    return data.__ob__\n  }\n\n  return new Observe(data)\n}\n","import { observe } from './observe/index'\n\nexport function initState(vm) {\n  // 获取所有的选项\n  const opts = vm.$options\n  if (opts.data) {\n    initData(vm)\n  }\n}\n\nfunction proxy(vm, target, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[target][key]\n    },\n    set(newValue) {\n      vm[target][key] = newValue\n    }\n  })\n}\n\nfunction initData(vm) {\n  let data = vm.$options.data // data可能是函数或者对象\n  data = typeof data === 'function' ? data.call(vm) : data\n\n  vm._data = data\n  // 对数据进行劫持 Object.defineProperty\n  observe(data)\n\n  // 将 vm._data 用vm来代理\n  for (let key in data) {\n    proxy(vm, '_data', key)\n  }\n}\n","import { initState } from './state'\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function (options) {\n    const vm = this\n    vm.$options = options\n\n    // 初始化状态\n    initState(vm)\n\n    if (options.el) {\n      vm.$mount(options.el)\n    }\n  }\n  Vue.prototype.$mount = function (el) {\n    console.log({el})\n    const vm = this\n    el = document.querySelector(el)\n    console.log(2,{el})\n\n    let opts = vm.$options\n    if (!opts.render) {\n      // 先查找有没有render函数\n      let template // 没有render 看一下 是否写了 template ，没有写template 采用外部的template\n      if (!opts.template && el) {\n        template = el.outerHTML\n      } else {\n        if (el) {\n          // 如果有el 则采用模板的内容\n          template = opts.template\n        }\n      }\n      console.log({ template })\n    }\n  }\n}\n","import { initMixin } from './init'\n\nfunction Vue(options) {\n  this._init(options)\n}\n\ninitMixin(Vue)\n\nexport default Vue\n"],"names":["oldArrayProto","Array","prototype","newArrayProto","Object","create","methods","forEach","method","args","result","call","inserted","ob","__ob__","slice","console","log","observeArray","Observe","data","defineProperty","value","enumerable","isArray","__proto__","walk","keys","key","defineReactive","item","observe","target","arguments","length","get","set","newValue","initState","vm","opts","$options","initData","proxy","_data","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","template","outerHTML"],"mappings":"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"}